<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="main.css">
</head>

<style>
  /* Style the comments container */
#comments {
  margin-top: 20px;
  border: 1px solid #ccc;
  padding: 20px;
  background-color: #f9f9f9;
}

/* Style the comment headers */
.comment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.comment-header h3 {
  margin: 0;
  font-size: 18px;
}

.comment-header .comment-date {
  font-size: 14px;
  color: #999;
}

/* Style the comment text */
#comments p {
  margin: 10px 0;
}

/* Style the comment list */
#comments ul {
  list-style: none;
  padding-left: 30px;
}

#comments li {
  margin-bottom: 20px;
  border-bottom: 1px solid #ccc;
  padding-bottom: 20px;
  padding-left: 10px;
}


#comments li:first-child {
  padding-left: 0px;
}

#comments img:first-child{
    margin-left:0px;
}

#comments img{
    margin-left:50px;
}
</style>
<body>

    <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="addnews.html">Add News</a></li>
        </ul>
    </nav>

    <div class="content" id="output">
        
    </div>

      <form id="comment-form">
        <div class="form-group">
            <label for="comment-name">Name:</label>
        <input type="text" id="comment-name" name="name">
        </div>
        <div class="form-group">
            <label for="avatar">Avatar:</label>
            <input type="text" id="avatar" name="avatar">
           </div>
       <div class="form-group">
        <label for="comment-body">Comment:</label>
        <textarea id="comment-body" name="body"></textarea>
       </div>
       
        <div>
            <button type="submit" class="btn">Add Comment</button>
        </div>
      </form>


     
       <div id="comments">
        <h2>Comments</h2>
        <ul id="newscomments"></ul>
       </div>
      
<script>

    // GET ALL NEWS


    // Get the URL parameter string
    const queryString = window.location.search;

    // Parse the query string to get the parameters as an object
    const urlParams = new URLSearchParams(queryString);

    // Get the value of the "id" parameter
    const id = urlParams.get('id');

    // Log the ID to the console
    console.log(id);


    // Get the output element
    var output = document.getElementById("output");


    fetch('https://64105fcb864814e5b64f9a34.mockapi.io/credo/v1/news/' + id, {
    method: 'GET',
    headers: {'content-type':'application/json'},
    }).then(res => {
    if (res.ok) {
        return res.json();
    }
    }).then(data => {
        // Do something with the list of news
        console.log(data);
            // Update the output element with API data
    output.innerHTML =  `
            <div>
                <img style="width: 100%;" src="${data.avatar}" alt="">
                <h1 style="font-weight:bold">${data.title}</h1>
                <p style="font-weight: bold;">Author: ${data.author}</p>
                <p style="font-size:14px; text-align: justify;">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Ipsa culpa libero voluptatem provident...</p>
               
                <hr><br /><br /><br /><br /><br /> 
            </div> 
            `;
    }).catch(error => {
    // handle error
    console.log(error);
    })







    ////// ADD COMMENT /////

    // Select the comment form and add an event listener to it
        const commentForm = document.getElementById('comment-form');
        commentForm.addEventListener('submit', addComment);

        // Function to handle the form submit event
        function addComment(event) {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Get the values of the name and body inputs
        const nameInput = document.getElementById('comment-name');
        const avatarInput = document.getElementById('avatar');
        const commentInput = document.getElementById('comment-body');
        const name = nameInput.value.trim();
        const avatar = avatarInput.value.trim();
        const comment = commentInput.value.trim();

        // Validate the inputs
        if (!name || !avatar || !comment) {
            alert('Please enter your name, avatar and comment');
            return;
        }
        
        // Get the blog post id from the URL or another source
        const commentid = urlParams.get('id');
        console.log(commentid);

        // Create a new comment object
        const newComment = {
            name: name,
            avatar: avatar,
            comment: comment,
            commentid: commentid

        };

        // Send a POST request to the API
        fetch('https://64105fcb864814e5b64f9a34.mockapi.io/credo/v1/comments', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify(newComment)
        })
        .then(response => {
            if (response.ok) {
            // If the response is successful, add the new comment to the UI
            const commentList = document.getElementById('comment-list');
            const newCommentElement = document.createElement('li');
            newCommentElement.textContent = `${name}: ${avatar} : ${comment}`;
            // commentList.appendChild(newCommentElement);

            // Clear the form inputs
            nameInput.value = '';
            avatarInput.value = '';
            commentInput.value = '';
            } else {
            // If the response is not successful, display an error message
            throw new Error('Failed to add comment');
            }
        })
        .catch(error => {
            console.error(error);
            // Display an error message to the user
            alert('Failed to add comment');
        });
        }








    //// GET COMMENTS /////
    fetch('https://64105fcb864814e5b64f9a34.mockapi.io/credo/v1/comments', {
    method: 'GET',
    headers: {'content-type':'application/json'},
    }).then(res => {
    if (res.ok) {
        return res.json();
    }
    }).then(data => {
        // Do something with the list of news
        console.log(data);
        data.forEach(function(comment){
            // Update the output element with API data
            if (comment.commentid === id) {
           const newscomments =  `
           <img style="width: 40px; height: 40px; border-radius:50%;" class="comment-img" src="${comment.avatar}" alt="">
            <li>
            <div class="comment-header">
              <h3>${comment.name}</h3>
            </div>
            <p>${comment.comment}</p>
          </li> 
            `;
         document.getElementById('newscomments').insertAdjacentHTML('beforeend', newscomments);
    }
    })
    }).catch(error => {
    // handle error
    console.log(error);
    })


</script>
</body>
</html>